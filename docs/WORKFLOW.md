# 서브 에이전트 워크플로우 (Sub Agent Workflow)

이 문서는 새로운 기능 개발을 위한 4단계 서브 에이전트 워크플로우를 정의합니다.

## 개요

새로운 기능 개발 시 다음 4단계 서브 에이전트 워크플로우를 사용하세요. 각 단계는 명확한 역할과 책임을 가집니다.

---

## 📋 서브에이전트 1: Planning & Documentation

**역할**: 기능 계획 및 명세서 작성

**작업 내용**:
1. 기능 요구사항 분석
2. `docs/FeatureName.md` 파일 생성
3. 다음 구조로 문서 작성:
   - 개요
   - 기능 상세 (UI, 동작 방식)
   - 기술 상세 (구현 방식, 기술 스택)
   - 관련 파일 목록 (추가/수정할 파일 경로)
4. `@AGENTS.md`의 "새로운 효과 추가" 섹션 참조하여 누락된 파일 없이 계획

**출력물**: 완성된 `docs/FeatureName.md`

**사용 예시**:
```
서브에이전트 1로 "Border" 기능을 위한 docs/Border.md 파일을 만들어줘.
@AGENTS.md의 "Adding new effects" 섹션을 참조해서 필요한 파일들을 모두 포함해줘.
```

---

## 🔨 서브에이전트 2: Implementation

**역할**: 명세서 기반 기능 구현

**작업 내용**:
1. `docs/FeatureName.md` 파일을 참조하여 구현
2. **토큰 최적화**: 파일 디렉토리 구조 활용
   - 필요한 파일만 선별적으로 읽기 (전체 파일 읽지 말 것)
   - `codebase_search`로 관련 코드 패턴 먼저 탐색
   - 유사 기능의 기존 파일 구조 참조 (예: `ShadowPanel.tsx` → `BorderPanel.tsx`)
   - `glob_file_search`로 유사 컴포넌트 찾기
3. 명세서에 명시된 파일 경로에 따라 구현
4. 기존 코드 패턴 준수 (styled-components, Jotai atoms, hooks 등)

**최적화 가이드**:
- ❌ 전체 파일을 읽기 전에 grep이나 codebase_search로 패턴 확인
- ✅ 유사 기능의 패널 컴포넌트 하나만 읽고 패턴 파악
- ✅ atoms 파일은 전체가 아닌 관련 섹션만 수정
- ✅ 타입이 필요한 경우 types 디렉토리 먼저 확인

**사용 예시**:
```
@docs/Border.md 를 기준으로 기능을 구현해줘. 
명세서에 있는 파일 디렉토리만 활용하고, 
유사한 기능(예: ShadowPanel)의 구조를 참조해서 최대한 토큰을 적게 사용해줘.
```

---

## ⚡ 서브에이전트 3: Code Optimization

**역할**: 구현된 코드 최적화 및 품질 개선

**작업 내용**:
1. 서브에이전트 2가 구현한 코드 검토
2. 다음 항목 체크 및 최적화:
   - **성능**: 불필요한 리렌더링 방지, 메모이제이션 필요 여부
   - **코드 품질**: ESLint 규칙 준수, 타입 안정성
   - **코드 중복**: 기존 유틸리티 함수 활용 가능 여부
   - **브라우저 호환성**: Safari 최적화 필요 여부 (SCALE_FACTOR 등)
   - **일관성**: 기존 코드 스타일 및 패턴 준수
3. `pnpm lint` 실행하여 린트 에러 확인 및 수정
4. 필요한 경우 리팩토링 수행

**체크리스트**:
- [ ] ESLint 에러 없음 (`pnpm lint` 통과)
- [ ] TypeScript 타입 에러 없음
- [ ] Safari 최적화 적용 (SafariImageCanvas.tsx 포함)
- [ ] 불필요한 리렌더링 없음
- [ ] 기존 코드 패턴과 일관성 유지

**사용 예시**:
```
서브에이전트 2가 구현한 Border 기능의 코드를 최적화해줘.
ESLint 체크하고, Safari 최적화도 확인해줘.
```

---

## 📝 서브에이전트 4: Documentation & Summary

**역할**: 작업 결과 문서화

**작업 내용**:
1. 구현 완료된 기능을 `docs/FeatureName.md`에 반영
2. 다음 정보 업데이트:
   - 구현 완료 체크리스트
   - 실제 구현된 파일 목록 (계획과 다른 경우 수정)
   - 기술 구현 상세 (실제 사용된 기법, 최적화 내용)
   - 사용 예시 또는 주의사항
3. 필요시 `@AGENTS.md`의 "각 서브 에이전트 문서 개요" 섹션 업데이트

**문서 구조 업데이트**:
```markdown
## 구현 완료

- [x] 관련 atom 추가
- [x] Panel 컴포넌트 생성
- [x] Canvas 렌더링 로직 추가
- [x] Safari 최적화 적용

## 관련 파일

- `src/atoms/imageAtoms.ts` - borderEnabledAtom, borderWidthAtom
- `src/components/panels/BorderPanel.tsx` - UI 컴포넌트
- ...
```

**사용 예시**:
```
서브에이전트 1-3에서 완료한 Border 기능의 작업 내용을 
docs/Border.md에 정리하고 업데이트해줘.
```

---

## 워크플로우 전체 예시

```
1. 서브에이전트 1: "Border 기능을 위한 docs/Border.md 생성"
2. 서브에이전트 2: "@docs/Border.md 기준으로 구현"
3. 서브에이전트 3: "구현된 Border 코드 최적화"
4. 서브에이전트 4: "Border 기능 문서 최종 업데이트"
```

---

## 🎯 사용 방법

### 방법 1: 전체 워크플로우 한 번에 요청 (권장)

```
"Border" 기능을 추가해줘. @docs/WORKFLOW.md의 4단계 서브 에이전트 워크플로우를 따라서:
1. 서브에이전트 1: docs/Border.md 생성
2. 서브에이전트 2: 구현
3. 서브에이전트 3: 최적화
4. 서브에이전트 4: 문서 업데이트
순서대로 진행해줘.
```

또는 더 간단하게:

```
"Border" 기능을 추가해줘. @docs/WORKFLOW.md의 서브 에이전트 워크플로우를 따라 전체 4단계를 실행해줘.
```

### 방법 2: 단계별 수동 실행

각 단계를 개별적으로 요청:

```
1단계: 서브에이전트 1로 "Border" 기능을 위한 docs/Border.md 만들어줘
```

```
2단계: @docs/Border.md 기준으로 서브에이전트 2로 구현해줘
```

```
3단계: 서브에이전트 3로 최적화해줘
```

```
4단계: 서브에이전트 4로 문서 업데이트해줘
```

### 방법 3: 특정 단계만 실행

특정 단계만 필요할 때:

```
서브에이전트 2로 @docs/Border.md를 구현해줘
```

---

## ⚠️ 주의사항

1. **자동 실행 안 됨**: 문서를 읽어도 자동으로 워크플로우가 시작되지 않습니다.
2. **명시적 요청 필요**: "4단계 워크플로우 실행해줘" 또는 "서브에이전트 1로 시작해줘"처럼 명확히 요청해야 합니다.
3. **@docs/WORKFLOW.md 참조**: `@docs/WORKFLOW.md`를 명시하면 AI가 워크플로우를 참조합니다.
4. **단계별 확인**: 각 단계 완료 후 다음 단계로 넘어가도록 요청하거나, 한 번에 전체를 요청할 수 있습니다.

---

## 💡 권장 사용 패턴

**새 기능 추가 시**:
```
"FeatureName" 기능을 추가해줘. @docs/WORKFLOW.md의 서브 에이전트 워크플로우 4단계를 모두 실행해줘.
```

**기존 기능 수정 시**:
```
@docs/Shadow.md의 shadow offset 범위를 1-100px로 변경해줘
```

**최적화만 필요할 때**:
```
서브에이전트 3로 현재 코드를 최적화해줘
```
